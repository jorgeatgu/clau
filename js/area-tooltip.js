const areaTooltip=()=>{const t={top:24,right:24,bottom:24,left:24};let a=0,e=0;const c=d3.select(".chart-lluvia-tooltip"),s=c.select("svg"),o={};let n;const r=d3.bisector(t=>t.fecha).left,l=(t,a)=>{o.count.x.range([0,t]),o.count.y.range([a,0])},i=c=>{const s=d3.axisBottom(o.count.x).tickFormat(d3.format("d")).ticks(13);c.select(".axis-x").attr("transform","translate(0,"+e+")").call(s);const l=d3.axisLeft(o.count.y).tickFormat(d3.format("d")).ticks(5).tickSizeInner(-a);c.select(".axis-y").call(l);const i=c.select(".focus"),d=c.select(".overlay");i.append("line").attr("class","x-hover-line hover-line").attr("y1",0).attr("y2",e),i.append("line").attr("class","y-hover-line hover-line").attr("x1",a).attr("x2",a),i.append("circle").attr("class","circle-focus").attr("r",8),i.append("text").attr("class","text-focus").attr("x",-10).attr("y",-20).attr("dy",".31em"),d.attr("width",a+t.left+t.right).attr("height",e).on("mouseover",function(){i.style("display",null)}).on("mouseout",function(){i.style("display","none")}).on("mousemove",function(){const t=o.count.x.invert(d3.mouse(this)[0]),a=r(n,t,1),c=n[a-1],s=n[a],l=t-c.fecha>s.fecha-t?s:c;i.attr("transform","translate("+o.count.x(l.fecha)+","+o.count.y(l.dias_lluvia)+")"),i.select("text").text(l.dias_lluvia),i.select(".x-hover-line").attr("y2",e-o.count.y(l.dias_lluvia)),i.select(".y-hover-line").attr("x1",0-o.count.x(l.fecha))})};function d(r){const d=c.node().offsetWidth;a=d-t.left-t.right,e=600-t.top-t.bottom,s.attr("width",d).attr("height",600);const u="translate("+t.left+","+t.top+")",f=s.select(".chart-lluvia-tooltip-container");f.attr("transform",u);const h=d3.area().x(t=>o.count.x(t.fecha)).y0(e).y1(t=>o.count.y(t.dias)).curve(d3.curveCardinal.tension(.6));l(a,e);const p=c.select(".area-container").selectAll(".area").data([n]),x=p.enter().append("path").attr("class","area area-bgc1");p.merge(x).attr("d",h),i(f)}window.addEventListener("resize",()=>{d()}),d3.csv("csv/dias-de-lluvia.csv",(t,a)=>{t?console.log(t):((n=a).forEach(t=>{t.fecha=t.fecha,t.dias_lluvia=t.dias}),(()=>{const t=s.select(".chart-lluvia-tooltip-container");t.append("g").attr("class","axis axis-x"),t.append("g").attr("class","axis axis-y"),t.append("g").attr("class","area-container"),t.append("rect").attr("class","overlay"),t.append("g").attr("class","focus").style("display","none")})(),(()=>{const t=d3.scaleTime().domain([d3.min(n,t=>t.fecha),d3.max(n,t=>t.fecha)]),a=d3.scaleLinear().domain([0,60]);o.count={x:t,y:a}})(),d())})};areaTooltip();