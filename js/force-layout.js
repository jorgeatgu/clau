const widthMobile=window.innerWidth>0?window.innerWidth:screen.width,color=d3.scaleOrdinal(["#f6d2d5","#f0b7bc","#ea969d","#e16973","#cc0011","#a2000d","#b8000f"]);function forceLayout(){const e=d3.select(".chart-force-maxima"),t=e.select("svg"),a=1.5;let r;const s=e.append("div").attr("class","tooltip tooltip-record").style("opacity",0),i=e.append("div").attr("class","tooltip tooltip-decade").style("opacity",0);function o(r){const o=e.node().offsetWidth;t.attr("width",o).attr("height",600);const c=t.selectAll(".circle-maxima").remove().exit().data(r).enter().append("circle").attr("class","circle-maxima").attr("r",e=>e.radius).attr("fill",e=>color(e.decade)).attr("cx",e=>e.x).attr("cy",e=>e.y).on("mouseover",function(e){const t=this;d3.selectAll(".circle-maxima").filter(function(e,a){return this!==t}).transition().duration(300).ease(d3.easeLinear).style("opacity",.1),s.transition(),s.style("opacity",1).html(`<p class="tooltip-record-max">En <span class="number">${e.year}</span> se establecieron <span class="number">${e.total}</span> récords.<p/>\n                        `)}).on("mouseout",()=>{d3.selectAll(".circle-maxima").transition().duration(800).ease(d3.easeLinear).style("opacity",1),s.transition().duration(200).style("opacity",0)});d3.forceSimulation().force("forceX",d3.forceX().x(.5*o)).force("forceY",d3.forceY().y(300)).force("center",d3.forceCenter().x(.5*o).y(300)).force("charge",d3.forceManyBody().strength(5)).force("collision",d3.forceCollide().radius(e=>e.radius+1)).nodes(r).force("collide",d3.forceCollide().strength(.5).radius(e=>e.radius+a).iterations(1)).on("tick",()=>c.attr("cx",({x:e})=>e).attr("cy",({y:e})=>e));const n=d3.group(r.map(e=>e.decade));let l=n.filter((e,t)=>n.indexOf(e)===t);l=l.reverse(e=>e.decade);const d=t.selectAll(".legend-maxima").remove().exit().data(l,e=>e).enter().append("g").attr("class",".legend-maxima").attr("year",e=>e);function p(e){const t=e.attr("year");d3.csv(csvFile,(e,a)=>{const r=a.filter(e=>String(e.decade).match(t));i.data(r).style("opacity",1).html(e=>`<p class="tooltip-record-max">Entre <span class="number">${e.decade}</span> y <span class="number">${Number(e.decade)+9}</span> se establecieron <span class="number">${e.totaldecade}</span> récords de temperatura ${record}.<p/>`)})}widthMobile>544?(d.attr("transform",(e,t)=>`translate(50,${25*(t+5)})`),d.append("text").attr("x",20).attr("y",10).text(e=>e)):(d.attr("transform",(e,t)=>`translate(${45*t},50)`),d.append("text").attr("x",14).attr("y",9).text(e=>e)),d.append("rect").attr("width",10).attr("height",10).style("fill",e=>color(e)),d.on("mouseover",function(e){const t=d3.select(this);d3.selectAll(".legend-maxima").transition().duration(300).ease(d3.easeLinear).style("opacity",.1),t.transition().duration(300).ease(d3.easeLinear).style("opacity",1),d3.selectAll(".circle-maxima").transition().duration(200).ease(d3.easeLinear).style("opacity",.1).filter(t=>t.decade===e).transition().duration(300).ease(d3.easeLinear).style("opacity",1),d3.select(this).call(p)}).on("mouseout",()=>{d3.selectAll(".legend-maxima").transition().duration(300).ease(d3.easeLinear).style("opacity",1),d3.selectAll(".circle-maxima").transition().duration(300).ease(d3.easeLinear).style("opacity",1),i.style("opacity",0)})}t.append("text").attr("class","legend-title").text("Décadas"),widthMobile>544?t.select(".legend-title").attr("transform","translate(50,110)"):t.select(".legend-title").attr("transform","translate(0,30)");window.addEventListener("resize",()=>{o(r)}),d3.csv("csv/total-records-max.csv",(e,t)=>{e?console.log(e):((r=t).forEach(e=>{e.size=widthMobile>544?+e.total/10:+e.total/17,e.radius=+e.size,e.year=e.year}),o(r))})}forceLayout();