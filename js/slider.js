var dataset,margin={top:50,right:50,bottom:0,left:50},width=960-margin.left-margin.right,height=500-margin.top-margin.bottom,histHeight=height/5,parseDate=d3.timeParse("%d/%m/%Y"),formatDateIntoYear=d3.timeFormat("%Y"),startDate=new Date("1951, 01, 01"),endDate=new Date("2019, 01, 01"),x=d3.scaleTime().domain([startDate,endDate]).range([0,width]).clamp(!0),y=d3.scaleLinear().range([histHeight,0]),histogram=d3.histogram().value(function(t){return t.date}).domain(x.domain()).thresholds(x.ticks(d3.timeYear)),svg=d3.select("#vis").append("svg").attr("width",width+margin.left+margin.right).attr("height",height+margin.top+margin.bottom),hist=svg.append("g").attr("class","histogram").attr("transform","translate("+margin.left+","+margin.top+")"),plot=svg.append("g").attr("class","plot").attr("transform","translate("+margin.left+","+margin.top+")");d3.csv("csv/histogram.csv",prepare,function(t){var a=histogram(t);y.domain([0,d3.max(a,function(t){return t.length})]),hist.selectAll(".bar").data(a).enter().append("g").attr("class","bar").attr("transform",function(t){return"translate("+x(t.x0)+","+y(t.length)+")"}).append("rect").attr("class","bar").attr("x",1).attr("width",function(t){return x(t.x1)-x(t.x0)-1}).attr("height",function(t){return histHeight-y(t.length)}).attr("fill",function(t){return"#f97d5a"}),drawPlot(dataset=t)});var currentValue=0,slider=svg.append("g").attr("class","slider").attr("transform","translate("+margin.left+","+(margin.top+histHeight+5)+")");slider.append("line").attr("class","track").attr("x1",x.range()[0]).attr("x2",x.range()[1]).select(function(){return this.parentNode.appendChild(this.cloneNode(!0))}).attr("class","track-inset").select(function(){return this.parentNode.appendChild(this.cloneNode(!0))}).attr("class","track-overlay").call(d3.drag().on("start.interrupt",function(){slider.interrupt()}).on("start drag",function(){currentValue=d3.event.x,update(x.invert(currentValue))})),slider.insert("g",".track-overlay").attr("class","ticks").attr("transform","translate(0,18)").selectAll("text").data(x.ticks(10)).enter().append("text").attr("x",x).attr("y",10).attr("text-anchor","middle").text(function(t){return formatDateIntoYear(t)});var handle=slider.insert("circle",".track-overlay").attr("class","handle").attr("r",9);function drawPlot(t){var a=plot.selectAll(".location").data(t);a.enter().append("circle").attr("class","location").attr("cx",function(t){return x(t.date)}).attr("cy",100).style("fill",function(t){return"#f97d5a"}).style("opacity",.65).attr("r",5).transition().duration(400).attr("cy",function(t){return Math.random()*(height/2+50-(height/2-50))+(height/2-50)}),a.exit().remove()}function update(t){handle.attr("cx",x(t)),drawPlot(dataset.filter(function(a){return a.date<t}))}function prepare(t){return t.date=parseDate(t.date),t.value=+t.value,t}